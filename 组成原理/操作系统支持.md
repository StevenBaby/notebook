# 操作系统支持

操作系统是控制程序在处理器上执行和管理该处理器资源的软件。操作系统具有许多功能，包括进程调度和存储管理。

操作系统最重要的功能之一时进程或任务的调度。操作系统决定给定时间内运行那个进程。一般情况下，硬件不断中断运行进程，使操作系统做出新的调度裁决，从而使处理器时间被几个进程公平分配。

操作系统的另一个重要的功能是存储管理。大多数当代操作系统都包含虚拟存储器的功能

虚拟存储器有两个优点：

- 进程在主存中运行时不需要将程序的全部指令和数据一次性装入主存
- 程序可用的总存储空间可以大大超过系统实际的主存容量。虽然存储管理是用软件完成的，但操作系统依赖于处理器中的硬件支持，包括分页管理硬件和分段管理硬件

## 操作系统概述

操作系统是一种控制应用程序运行和在计算机用户于计算机硬件之间提供接口的程序，它有两个目标：

- 方便：操作系统使计算机使用起来更方便
- 有效：操作系统允许计算机系统的资源以有效的方式使用。

最重要的系统程序是操作系统，操作系统对程序员屏蔽硬件细节，为程序员使用计算机系统提供方便的接口。它作为一个中间软件，是程序员和应用程序都十分容易访问和使用系统提供的资源和服务。

操作系统主要提供以下服务：

- 程序创建：

- 程序执行

- 存取IO设备

- 文件的存取控制

- 系统存取

- 错误检查和相应

- 统计

计算机是一组具有传送、存储和处理数据并控制这些功能的资源，而操作系统负责管理这些资源。

操作系统作为控制结构在这两方面很独特：

- 操作系统功能的实现于普通计算机软件相同也就是说，它是由处理器执行的程序
- 操作系统经常放弃控制权，并必须依赖处理器的启用而重新获得控制权

操作系统分类方式有两种，一种是把操作系统分成**批处理**和**交互式处理**

交互式系统中，用户或程序员通常用键盘或显示器终端直接与计算机交互，请求执行一个作业或处理一个事务。而且用户可以根据应用程序的性质，在作业执行期间与计算机通信。

批处理系统与交互式系统相反，许多用户程序打包后由计算机操作员提交处理，程序结束后，打印处理结果。单纯的批处理系统目前用得很少。

另一种分类是，**单道程序设计**和 **多道程序设计**。

## 调度

多道程序的关键是调度。事实上，调度有四种典型的类型。

- 长期调度：决定添加道待执行进程池中的进程数量
- 中期调度：决定添加到主存中的进程数
- 短期调度：决定处理器将执行哪个进程
- IO调度：决定哪个进程未决的IO请求将被IO设备处理

进程，这个术语在20世纪60年代首次由Multics操作系统的设计者提出，在某种程度上，他是比“作业”更通用的术语。进程有很多定义:

- 一个运行的程序
- 程序的“活灵魂”
- 处理器分配的实体

进程状态：

- 新建：由高级调度程序提交一个程序，操作系统创建一个进程，将它移入就绪状态
- 就绪：进程已准备就绪，正在等待处理器的执行
- 运行：进程正在被处理器执行
- 阻塞：进程为等待一些系统资源，由运行状态挂起
- 终止：进程技术，由操作系统销毁

进程控制块(PCB):

- 标识符：每个当前进程都有一个唯一的标识符
- 状态：进程的当前状态
- 优先级：进程的相对优先级别
- 程序计数器：要执行的程序中的下一条指令的地址
- 存储器指针：进程在存储器中的起始位置和结束位置
- 现场数据：处理器在寄存器中的数据
- IO状态信息：
- 统计信息：

## 存储器管理

在单道程序设计系统中，主存划分为两个部分：一部分分配给操作系统，一部分分配给当前正在执行的程序。在多道程序设计系统中，存储器的“用户”存储区需进一步细分供多个进程使用。细分存储器的任务由操作系统动态的执行，并称为**存储器管理**。

**分区**

最简单的分区机制是固定长度的分区，但是也浪费了内存。在多数情况下，进程对分区大小的需求不可能和提供的分区大小完全一样。

更有效的方法是使用变长分区，当一个进程调入主存时，分配的分区大小可以与进程所需大小一样。这种方法开始时比较好，但是最后它将导致存储器中出现许多小的空块。导致利用率下降。解决这个问题的一种方法时**紧缩**：操作系统一次又一次地移动存储器中的进程，把所有的空闲块放置在一起，组成一个块。但这个过程很费时，会浪费处理器时间。

指令由两种类型的存储器单元的地址：

- 数据的地址
- 指令的地址用于转移指令

逻辑地址：表示相对于起始单元的地址
物理地址：主存中的实际单元地址

**分页**

不等的固定长度和可变长分区，其存储器使用率都很低，假设把存储器分成相当小的、相等的固定长的存储块，将每个进程也划分成小的固定长的程序块，那么程序的每个程序快能分配道存储器中可用的每个存储块（称为帧或页帧）中，于是存储器分配进程后浪费的空间最多知识最后一页的一小部分。

**虚拟存储器**

分页技术使得多道程序设计系统变得真正有效，而把进程分页这一简单策略导致了另一重要的概念的产生-虚拟存储器。

请求分页：一个进程的每个页只有在需要时才调入

页失效
页替换
换页抖动

换页算法，目前比较有效的技术时最近最少使用算法(LRU)。不过很难实现，因此常用一些性能近似于LRU的算法。

因为进程只在主存中执行，所以主存被称为实存储器。虚拟存储器，分配在磁盘上，使多道程序设计更为有效，同事消除了用户使用主存的限制。

**分段**

分页对程序员是不可见的，其目的是为程序员提供较大的地址空间。而分段对程序员是可见的，它使组织程序和数据更方便，能将特权、保护属性和指令、数据联系起来。

分段有许多优点：

- 它简化了对数据结构的处理
- 它将程序分段允许每段程序独立地修改和重编译，不需要整个程序重新连接和重装入，即使用多个段来完成
- 可以实现进程共享。
- 可以实现段保护

## 参考资料

- [1] 计算机组成与体系结构 [美] William Stallings 著
