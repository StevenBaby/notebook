# 外部存储器

磁盘至今仍是最重要的外部存储器。从个人计算机到大型机，乃至超级计算机，都广泛使用活动式磁盘和固定式磁盘（硬盘）。

为了实现更高的性能和更好的可用性，服务器以及更大系统使用RAID磁盘技术。RAID使用了多个磁盘作为数据存储设备的并行整列的一系列技术，并具有在冗余性来弥补磁盘故障。

在各种类型的计算机系统中，光存储技术变的日益重要。CD-ROM技术已广泛使用多年，而像可写式CD和DVD这类更加新近的技术也正在兴起。

## 磁盘

磁盘时一种由非磁性材料制成称为衬底的圆盘，其上涂有一层词性材料。传统上，衬底一直使用铝或者铝合金材料，最近推出了玻璃衬底。玻璃衬底有很多优点：

- 改善了磁层表面的均匀性，从而增强了磁盘的可靠性
- 显著地减少了整个表面的缺陷，从而有助于读写错误的减少
- 能支持更低的磁头飞行速度
- 更好的刚度，从而降低了磁盘动力需求
- 更好的耐冲击力和耐磨损能力

### 磁读写机制

数据记录和其后的读出都是通过**磁头**和导线圈进行的。多数系统有两个磁头：读磁头、写磁头。在读写操作期间，磁头静止不动，而盘片在非常靠近磁头的下方高速旋转。

写机制使用了电流通过线圈时产生磁场的这个效应。脉冲电流送入写磁头，形成的磁化模式被记录在其下的磁盘表面上，正、负电流分别产生不同的磁化模式。

### 数据组织和格式化

磁头时一种相对较小的装置，盘上的数据组织呈现为一组同心圆环，圆被称为**磁道**，每个磁道于磁头同宽。每个盘面上有数千个磁道。

相邻磁道之间有间隙，他们可以防止或至少可以减少由于磁头未对准或磁域干扰所引起的错误。

数据以**扇区**为单位传入传出磁盘，每个磁道通常有数百个扇区，其长度可固定也可变化。当前，大多数系统使用固定长度的扇区，512字节几乎时通用扇区的大小。相邻扇区也留有间隙。

靠近转盘中心位经过一固定点的传输要比外沿慢，因此，必须找一种方式来补偿速率的变动。可以通过增大记录在盘片区域上的信息位之间的间隔来实现。于是以固定速度旋转能够以相同的速率来扫描所有信息，该速度称为**恒定角速度(constant angular velocity CAV)**。

使用**CAV的好处**是，能以磁道号和扇区号来直接寻址各个数据块。为了将磁头从当前位置移动到指定位置，只需将磁头径向移动到指定磁道，然后等待指定扇区转到磁头下，整个耗时很少。**CAV的缺点**是，外围的长磁道上存储数据需与内圈的短磁道上所存储数据一样多。

因为**线性密度**，即每英寸的位数，由外圈磁道到内圈磁道是逐渐增大的，所以在直截了当的CAV系统中，存储容量受到了内圈所能实现的最大记录密度的限制。为了提高密度，当今的硬盘系统使用了一种称之为**多重区域记录(multiple zone recording)**的技术，它将盘面划分成多个区域，典型的是16区，在一个区域中，各磁道的位数是恒定的，远离中心的区域要比靠近中心的区域容纳更多的位，这就允许以稍微复杂一些的电路为代价全面提升磁盘存储容量。当磁头由一个区域移动到另一个区域时，位长度的改变引起读写时序相应的变动。

需要某种方式来确定一个磁道内的扇区位置。显然，磁道必须有一些起始点和辨识每个扇区的起点及终点的方法。这些需求由记录在磁盘上的控制数据来处理。因此，磁盘格式花时，会附有一些仅被磁盘驱动器使用而不被用户读取的额外数据。

### 物理特性

磁头在磁盘径向上可以是固定的，也可以是移动的。

**固定头磁盘**

每个磁道有一个读写头，所有磁头安装在跨越所有磁道的固定支架上，这种系统目前已经很少

**可移动头磁盘**

只有一个读写头，磁头固定在支架上，但支架能伸缩，以使磁头能定位到任何磁道上

磁盘本身安装在磁盘驱动器内，而驱动器由支架、带动盘片旋转的主轴和二进制数据输入输出所需要的电路组成。

大多数磁盘两面都有可磁化的涂层，称为双面磁盘，也有单面磁盘。

某些磁盘驱动器内垂直安装多个盘片，间隔约1英寸，同事安装多个支架。多盘片磁盘使用可移动磁头，每面有一个读写磁头，所有这次磁头被机械固定，以便于盘片中心等距离一起移动。所有盘片上相同的相对位置的一组磁道被称为柱面。

根据磁头机制可以把磁盘分为三大类。传统上，读写头放置在盘片上方的固定距离，允许有一个气隙，另一个极端的情况时，读写头在读或写操作时实际地物理接触磁表面，这种机制用于软盘，其容量小，使用灵活，价格便宜。

### 磁盘性能参数

磁盘I/O操作的实际细节取决于计算机系统、操作系统、I/O通道特性和磁盘控制器硬件。

当磁盘驱动器运行时，磁盘以恒定的速度旋转。为了读或者写操作，磁头必须精确定位想要的磁道和该磁道上想要的扇区起始位置。磁道的选择包括在可移动磁头系统中移动磁头或固定磁头系统中选择磁头。可移动磁头系统中，磁头定位到该磁道所花的时间称为**寻道时间**。无论哪一种磁头系统，一旦磁道被选定，磁盘控制器将处于等待状态，直到相应的扇区旋转到磁头可以进行读写的位置。等待相应扇区的起始处到达磁头的这段时间称为**旋转延迟**。寻到时间和旋转延迟的总和称为**存取时间**，即定位到读写位置的时间。一旦磁头定位后，扇区旋转到磁头下方，就可完成读或写操作；这是整个操作的数据传送部分，传送所需的时间称为**传送时间**。

除了存取时间和传送时间以外，常有几个与磁盘I/O操作有关的队列延迟。当进程发出一个I/O请求后，它首先要在一个队列中等待所需设备变为可用，直到此设备被分配给该进程。如果该设备与其他磁盘驱动器共享一个或者一组I/O通道，则还可能有下一个附加等待，等待相关通道变为有效。此时，寻道工作完成，开始磁盘存取。

旋转定位检测技术

扇区的读取次序对I/O性能有巨大影响。当文件由多个扇区组成是，我们由某种控制扇区分布的方法。虽然如此，即使是多道程序下的文件访问，也会存在I/O请求竞争同意磁盘的问题。因此考虑一种改善I/O性能的办法，使之能超出纯随机存取的性能，是很有价值的。这导致对磁盘调度算法的考虑。

## RAID 

- RAID 是一组物理磁盘驱动器，在操作系统下被视为一个单一的逻辑驱动器
- 数据以条带化的方式分布在一组物理磁盘上
- 冗余磁盘容量用于存储奇偶校验信息，保证磁盘万一损坏时能恢复数据

## 参考资料

- [1] 计算机组成与体系结构 [美] William Stallings 著
