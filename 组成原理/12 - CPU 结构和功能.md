# 12 - CPU 结构和功能

处理器包括用户可见的寄存器和控制/状态寄存器，用户可见寄存器是指，用户使用机器指令显示或隐式可访问的寄存器。他们可以是通用寄存器，也可以是用与定点或浮点数、地址、变址和段指针这样的专用寄存器。控制和状态寄存器用于控制CPU的操作。一个明显的例子是程序计数器。另一个重要的例子是程序状态字(PSW)，它包含各种状态和条件位，例如反映最近一次算术运算结果的标志位、终端允许位和指示CPU当前运行于特权模式下还是用户模式下的状态位。

处理器采用指令流水方式来加速指令的执行。从本质上讲，流水是指将指令周期分解成几个连续出现的阶段，如读指令、译码指令、确定操作数地址、取操作数、执行指令和写结果操作数。指令向前移动通过这些段，就像车间的一条装配线一样；于是不同的指令能同时在各个段上工作，不过转移和指令间相关性的出现，使流水线的设计和使用变得复杂了。

## CPU 组成

CPU 必须完成一下任务：

- 取指令: CPU必须从存储器(寄存器、cache、主存)读取指令
- 解释指令：必须对指令进行译码，已确定所要求的动作
- 取数据：指令的执行可能要求从存储器或输入输出模块读取数据
- 处理数据：指令的执行可能要求对数据完成某种算术或逻辑运算
- 写数据：执行的结果可能要求写数据到存储器或IO模块

CPU 的主要部件是一个算术逻辑单元(ALU)和一个控制器(CU)，若干寄存器。ALU完成数据的实际计算或处理。控制器控制数据和指令的移入移出CPU，并控制ALU操作。

## 寄存器组成

计算机系统采用了存储器分级系统。CPU内有一组寄存器，他们的存储器级别在分级系统中位于主存和cache之上，CPU中的寄存器可分为两类：

- 用户可见寄存器：允许机器语言或汇编语言的编程人员通过优化寄存器的使用而减少对主存的访问
- 控制和状态寄存器：由控制器来控制CPU的操作，并由拥有特权的操作系统程序来控制程序的执行。

这两类寄存器的划分界限并不明确。

### 用户可见寄存器

用户可见寄存器是指可以通过机器语言方式访问的寄存器，这些用户可见寄存器可分为：通用、数据、地址、条件码。

**通用寄存器** 可以被程序员指派各种用途。有时，他们在指令集中的使用是正交于操作的，即任何通用寄存器能为任何操作吗容纳操作数。这展现了真正通用的意义。然而，常常不是这样，而是有些限制。例如，可能有专用于浮点操作和栈操作的通用寄存器。

**段指针**：提供分断寻址的机器中，段寄存器保持着该段的基地址。可以有多个段寄存器。

**变址寄存器**：这些寄存器用于变址寻址，并可能是自动变址的

**栈指针**：若有用于可见的栈寻址方式，则一边来说栈会被分配在存储器中，而CPU内有一专用的寄存器指向栈顶。这允许隐含寻址，即push、pop和其他不需要显示地指定栈操作数的栈指令。

## 指令周期

指令周期包括以下子周期：

- 取指
- 执行
- 中断

## 指令流水线技术


## 参考资料

- [1] 计算机组成与体系结构 [美] William Stallings 著
